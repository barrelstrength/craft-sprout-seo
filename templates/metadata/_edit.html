{% extends "sproutseo/_layouts/base" %}
{% import "_includes/forms" as forms %}

{% set title %}
	{% if not metaTagGroupId is empty %}
		{{ metaTags.name }}
	{% else %}
		{{ "New Metadata Section"|t }}
	{% endif %}
{% endset %}

{% set crumbs = [
{ label: "Metadata"|t, url: url('sproutseo/metadata') }
] %}

{% set centered = true %}

{% set fullPageForm = true %}

{% if craft.request.getSegment(3) == 'new' %}
	{% set saveShortcutRedirect = url('sproutseo/metadata') %}
{% else %}
	{% set saveShortcutRedirect = url('sproutseo/metatags/' ~ metaTagGroupId) %}
{% endif %}

{# Set a field context so we can manage field visibility between the SEO Meta Tag Groups and the Field Types #}
{% set fieldContext = 'metaTagGroups' %}

{# Map the `metaTags` object to `values` so we can use the same templates for SEO Meta Tag Groups and the Field Types #}

{% set values = metaTags %}

{% block saveButton %}
	<div class="buttons">
		<input class="btn submit" type="submit" value="Save">
	</div>
{% endblock %}

{% block main %}

	<div class="grid first" data-max-cols="3">
		<div class="item" data-position="left" data-min-colspan="2" data-max-colspan="3">
			<div id="fields" class="pane">

				<input type="hidden" name="action" value="sproutSeo/metaTags/saveMetaTagGroup">
				<input type="hidden" name="redirect" value="sproutseo/metadata">

				<input type="hidden" name="sproutseo_fields[id]" value="{{ metaTagGroupId }}">


				{% include 'sproutseo/_fieldtypes/optimize/input' %}

			</div>
		</div>
		<div class="item" data-position="right" data-colspan="1">
			<div class="pane meta">

				{{ forms.textField({
					label: "Name <span class='info'>Human readable Meta Tag Group name</span>"|t,
					id: "name",
					name: 'sproutseo_fields[name]',
					value: metaTags.name,
					errors: metaTags.getErrors('name'),
					required: true
				}) }}

				{{ forms.textField({
					label: "Handle <span class='info'>Name you will use to refer to this meta-tag group in your templates</span>"|t,
					id: "handle",
					name: 'sproutseo_fields[handle]',
					value: metaTags.handle,
					errors: metaTags.getErrors('handle'),
					required: true
				}) }}

				{{ forms.textField({
					label: "URL"|t,
					id: "url",
					name: 'sproutseo_fields[url]',
					value: metaTags.url,
					errors: metaTags.getErrors('url'),
					required: true
				}) }}

				{{ forms.lightswitchField({
					label: "Site Name <span class='info'>Append Site Name '" ~ siteName ~ "' to all Titles</span>"|t,
					name: 'sproutseo_fields[appendSiteName]',
					on: metaTags.appendSiteName
				}) }}

				<div class="field" id="enabled-field">
					<div class="heading"></div>
					<div class="input">
						<div class="right">
							<input type="button" class="btn small formsubmit" value="Delete" data-action="sproutForms/entries/deleteEntry" data-confirm="Are you sure you want to delete this entry and all of it's data?" data-redirect="sproutforms/entries">
						</div>
					</div>
				</div>

			</div>

			<div class="pane meta">

				{% set schemaMaps = {
					'': 'Select...'|t,
					'schemaMapId1': 'News Article'|t,
					'productType1': 'Product One'|t,
					'productType2': 'Product Two'|t,
				} %}

				{{ forms.selectField({
					label: "Main Entity <span class='info'>Define your Main Entity. Map the primary element that displays on this page to a Structured Data schema for improved metadata.</span>"|t,
					name: 'sitemap_fields[???][schemaMap]',
					options: schemaMaps,
					value: (sitemap.schemaMap is defined ? sitemap.schemaMap : 0.5),
					errors: "",
					required: false
				}) }}
			</div>

			<div class="pane meta">
				{% set priorityList = {
				'1.0': '1.0 ↑ Highest'|t,
				'0.9': '0.9',
				'0.8': '0.8',
				'0.7': '0.7',
				'0.6': '0.6',
				'0.5': '0.5',
				'0.4': '0.4',
				'0.3': '0.3',
				'0.2': '0.2',
				'0.1': '0.1',
				'0.0': '0.0 ↓ Lowest'|t
				} %}

				{% set frequencyList = {
				'always': 'Always'|t,
				'hourly': 'Hourly'|t,
				'daily': 'Daily'|t,
				'weekly': 'Weekly'|t,
				'monthly': 'Monthly'|t,
				'yearly': 'Yearly'|t,
				'never': 'Never'|t
				} %}

				{{ forms.selectField({
					label: "Priority"|t,
					name: 'sitemap_fields[???][priority]',
					options: priorityList,
					value: (sitemap.priority is defined ? sitemap.priority : 0.5),
					errors: "",
					required: false
				}) }}

				{{ forms.selectField({
					label: "Change Frequency"|t,
					name: 'sitemap_fields[???][changeFrequency]',
					options: frequencyList,
					value: (sitemap.changeFrequency is defined ? sitemap.changeFrequency : 'weekly'),
					errors: "",
					required: false
				}) }}

				{{ forms.lightswitchField({
					label: "Sitemap Enabled"|t,
					name: 'sitemapEnabled',
					on: true,
					onLabel: "Enable"|t,
				}) }}

			</div>

			<div class="pane meta">
				{% if settings.displayPreview %}
					<ul class="sproutseo-preview-btns">
					<li class="selected">Search</li>
					<li>Facebook</li>
					<li>Twitter</li>
					</ul>

					{% include 'sproutseo/_fieldtypes/optimize/previews/search' %}

					{#{% include 'sproutseo/_fieldtypes/optimize/previews/opengraph' %}#}

					{#{% include 'sproutseo/_fieldtypes/optimize/previews/twittercard' %}#}

				{% endif %}
			</div>

		</div>
	</div>

{% endblock %}

{% if metaTags.name is not defined or not metaTags.handle %}
	{% includeJs "new Craft.HandleGenerator('#name', '#handle');" %}
{% endif %}

{% includeJsResource "sproutseo/js/MetaTags.js" %}

{% set js %}

	new Craft.SproutSeoMetaTags();

{% endset %}

{% includeJs js %}
