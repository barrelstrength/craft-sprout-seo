{% extends "sproutseo/_layouts/base" %}
{% import "_includes/forms" as forms %}

{% set title %}
  {% if not defaultId is empty %}
    {{ default.name }}
  {% else %}
    New Meta
  {% endif %}
{% endset %}

{% set crumbs = [
	{ label: "Globals"|t, url: url('sproutseo/globals/meta-tags') }
] %}

{% set tabs = {
	main: {
		label: "General"|t,
		url: '#default-basic'
	},
	facebook: {
		label: "Facebook"|t,
		url: '#default-facebook'
	},
	twitter: {
		label: "Twitter"|t,
		url: '#default-twitter'
	}
} %}

{% set centered = true %}

{% set fullPageForm = true %}

{% if craft.request.getSegment(3) == 'new' %}
	{% set saveShortcutRedirect = url('sproutseo/globals/meta-tags') %}
{% else %}
	{% set saveShortcutRedirect = url('sproutseo/globals/meta-tags/' ~ defaultId) %}
{% endif %}

{# Set a field context so we can manage field visibility between the SEO Defaults and the Field Types #}
{% set fieldContext = 'defaults' %}

{# Map the `defaults` object to `values` so we can use the same templates for SEO Defaults and the Field Types #}
{% set values = default %}

{% block saveButton %}
	<div class="buttons">
		<input class="btn submit" type="submit" value="Save">
	</div>
{% endblock %}

{% block main %}

<div class="grid first" data-max-cols="3">
	<div class="item" data-position="left" data-min-colspan="2" data-max-colspan="3">
		<div id="fields" class="pane">

			{% include "_includes/tabs" %}

				<input type="hidden" name="action" value="sproutSeo/metaDefaults/saveDefault">
				<input type="hidden" name="redirect" value="sproutseo/meta">

				<input type="hidden" name="sproutseo_fields[id]" value="{{ defaultId }}">

				<div id="default-basic">

					{% include 'sproutseo/_partials/fields/input' %}

					<hr>

					{{ forms.checkboxField({
						label: "Customize Location Info"|t,
						name: 'hasTitleField',
						toggle: 'default-location',
						checked: false
					}) }}

					<div id="default-location" class="hidden">
						{% include 'sproutseo/_partials/fields/geo' %}
					</div>

					<hr>

					{{ forms.checkboxField({
						label: "Customize Robot Behavior"|t,
						name: 'hasTitleField',
						toggle: 'default-robots',
						checked: false
					}) }}

					<div id="default-robots" class="hidden">
						{% include 'sproutseo/_partials/fields/robots' %}
					</div>

				</div>

				<div id="default-facebook" class="hidden">
					{% include 'sproutseo/_partials/fields/open-graph' with { values : default } %}
				</div>

				<div id="default-twitter" class="hidden">
					{% include 'sproutseo/_partials/fields/twitter-card' with { values : default } %}
				</div>

		</div>
	</div>
	<div class="item" data-position="right" data-colspan="1">
		<div class="pane meta">

			{{ forms.textField({
				label: "Meta Name <span class='info'>Human readable default name</span>"|t,
				id: "name",
				name: 'sproutseo_fields[name]',
				value: default.name,
				errors: '',
				required: true
			}) }}

			{% set globalFallbackId = craft.sproutSeo.globalFallbackId() %}

			{% if not globalFallbackId or (globalFallbackId == defaultId) %}
				{{ forms.lightswitchField({
					label: "Global Meta <span class='info'>Use this default as my global fallback</span>"|t,
					name: 'sproutseo_fields[globalFallback]',
					on: default.globalFallback
				}) }}
			{% endif %}

			{{ forms.lightswitchField({
				label: "Site Name <span class='info'>Append Site Name '" ~ siteName ~ "' to all Titles</span>"|t,
				name: 'sproutseo_fields[appendSiteName]',
				on: default.appendSiteName
			}) }}

			<div class="field" id="enabled-field">
				<div class="heading"></div>
				<div class="input">
					<div class="right">
						<input type="button" class="btn small formsubmit" value="Delete" data-action="sproutForms/entries/deleteEntry" data-confirm="Are you sure you want to delete this entry and all of it's data?" data-redirect="sproutforms/entries">
					</div>
				</div>
			</div>

		</div>
	</div>
</div>

{% endblock %}

{% set sidebar %}

		<nav class="last">

		</nav>


{% endset %}

{% if default.name is not defined or not default.handle %}
	{% includeJs "new Craft.HandleGenerator('#name', '#handle');" %}
{% endif %}

{% includeJsResource "sproutseo/js/default.js" %}

{% set js %}

new Craft.SproutSeoDefault();

{% endset %}

{% includeJs js %}
