{% extends "sproutseo/_layouts/base" %}
{% import "_includes/forms" as forms %}

{% set title %}
  {% if not metaTagGroupId is empty %}
    {{ metaTags.name }}
  {% else %}
    {{ "New Meta Tag Group"|t }}
  {% endif %}
{% endset %}

{% set crumbs = [
	{ label: "Globals"|t, url: url('sproutseo/globals/meta-tags') }
] %}

{% set tabs = {
	main: {
		label: "General"|t,
		url: '#metatags-basic'
	},
	facebook: {
		label: "Facebook"|t,
		url: '#metatags-facebook'
	},
	twitter: {
		label: "Twitter"|t,
		url: '#metatags-twitter'
	}
} %}

{% set centered = true %}

{% set fullPageForm = true %}

{% if craft.request.getSegment(3) == 'new' %}
	{% set saveShortcutRedirect = url('sproutseo/globals/meta-tags') %}
{% else %}
	{% set saveShortcutRedirect = url('sproutseo/globals/meta-tags/' ~ metaTagGroupId) %}
{% endif %}

{# Set a field context so we can manage field visibility between the SEO Meta Tag Groups and the Field Types #}
{% set fieldContext = 'defaults' %}

{# Map the `metaTags` object to `values` so we can use the same templates for SEO Meta Tag Groups and the Field Types #}
{% set values = metaTags %}

{% block saveButton %}
	<div class="buttons">
		<input class="btn submit" type="submit" value="Save">
	</div>
{% endblock %}

{% block main %}

<div class="grid first" data-max-cols="3">
	<div class="item" data-position="left" data-min-colspan="2" data-max-colspan="3">
		<div id="fields" class="pane">

			{% include "_includes/tabs" %}

				<input type="hidden" name="action" value="sproutSeo/metaTags/saveMetaTagGroup">
				<input type="hidden" name="redirect" value="sproutseo/globals/meta-tags">

				<input type="hidden" name="sproutseo_fields[id]" value="{{ metaTagGroupId }}">

				<div id="metatags-basic">

					{% include 'sproutseo/_partials/fields/input' %}

					<hr>

					{{ forms.checkboxField({
						label: "Customize Location Info"|t,
						name: 'hasTitleField',
						toggle: 'metatags-location',
						checked: false
					}) }}

					<div id="metatags-location" class="hidden">
						{% include 'sproutseo/_partials/fields/geo' %}
					</div>

					<hr>

					{{ forms.checkboxField({
						label: "Customize Robot Behavior"|t,
						name: 'hasTitleField',
						toggle: 'metatags-robots',
						checked: false
					}) }}

					<div id="metatags-robots" class="hidden">
						{% include 'sproutseo/_partials/fields/robots' %}
					</div>

				</div>

				<div id="metatags-facebook" class="hidden">
					{% include 'sproutseo/_partials/fields/open-graph' with { values : metaTags } %}
				</div>

				<div id="metatags-twitter" class="hidden">
					{% include 'sproutseo/_partials/fields/twitter-card' with { values : metaTags } %}
				</div>

		</div>
	</div>
	<div class="item" data-position="right" data-colspan="1">
		<div class="pane meta">

			{{ forms.textField({
				label: "Name <span class='info'>Human readable Meta Tag Group name</span>"|t,
				id: "name",
				name: 'sproutseo_fields[name]',
				value: metaTags.name,
				errors: '',
				required: true
			}) }}

			{{ forms.textField({
				label: "Handle <span class='info'>Name you will use to refer to this meta-tag group in your templates</span>"|t,
				id: "handle",
				name: 'sproutseo_fields[handle]',
				value: metaTags.handle,
				errors: '',
				required: true
			}) }}

			{% set globalFallbackId = craft.sproutSeo.globalFallbackId() %}

			{% if not globalFallbackId or (globalFallbackId == metaTagGroupId) %}
				{{ forms.lightswitchField({
					label: "Global Meta <span class='info'>Use this Meta Tag Group as my global fallback</span>"|t,
					name: 'sproutseo_fields[globalFallback]',
					on: metaTags.globalFallback
				}) }}
			{% endif %}

			{{ forms.lightswitchField({
				label: "Site Name <span class='info'>Append Site Name '" ~ siteName ~ "' to all Titles</span>"|t,
				name: 'sproutseo_fields[appendSiteName]',
				on: metaTags.appendSiteName
			}) }}

			<div class="field" id="enabled-field">
				<div class="heading"></div>
				<div class="input">
					<div class="right">
						<input type="button" class="btn small formsubmit" value="Delete" data-action="sproutForms/entries/deleteEntry" data-confirm="Are you sure you want to delete this entry and all of it's data?" data-redirect="sproutforms/entries">
					</div>
				</div>
			</div>

		</div>
	</div>
</div>

{% endblock %}

{% set sidebar %}

		<nav class="last">

		</nav>


{% endset %}

{% if metaTags.name is not defined or not metaTags.handle %}
	{% includeJs "new Craft.HandleGenerator('#name', '#handle');" %}
{% endif %}

{% includeJsResource "sproutseo/js/MetaTags.js" %}

{% set js %}

new Craft.SproutSeoMetaTags();

{% endset %}

{% includeJs js %}
